<!DOCTYPE html>
<html>
<head>
	<title>Chat Application</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">











		<script> 
// var retrievedData = localStorage.getItem("ActiveUser")
// var dd = JSON.parse(retrievedData);
// console.log("string",dd)
	// var UserArray = []
	var name = prompt("Please enter your name");
	while(name ==''){name = prompt("Please enter your name");}
	// var UserArray = JSON.parse(localStorage.getItem("ActiveUser"))
	// localStorage.clear();
	// console.log(localStorage.getItem("ActiveUser").lenght)
	// var a = UserArray.push(name);
	// console.log(a)
	// localStorage.setItem("ActiveUser2","hi")
	// console.log(localStorage.getItem("ActiveUser2"));
</script>
	<script src="https://kit.fontawesome.com/c153436894.js" crossorigin="anonymous"></script>
	<style>
		.textbox{
			bottom: 0;
		}
		.boxheigth{
			height: calc(100vh - 129px);
		}
		.rounded {
		    border-radius: 0.5rem!important;
		}
		ul li{
			width:fit-content;
			max-width: 70%;
		}
		ul{list-style-type: none;}
		.bgcolor{
			font-family: 'Kalam', cursive;
			background-color: paleturquoise;padding: 13px 0;
		    border-top-right-radius: 1.25rem!important;
		    border-top-left-radius: 1.25rem!important;
		}
		.br{border-bottom-right-radius: 1.25rem!important;}
		.bl{border-bottom-left-radius: 1.25rem!important;}
		.jointtxt{font-size: 10px; background-color: darkgrey;}
		.rounded {border-radius: 0.25rem!important;}
		::-webkit-scrollbar {
		  width: 5px;
		}
		/* Track */
		::-webkit-scrollbar-track {
		  box-shadow: inset 0 0 5px grey; 
		  border-radius: 100px;
		}
		/* Handle */
		::-webkit-scrollbar-thumb {
		  background: red; 
		  border-radius: 100px;
		}
		/* Handle on hover */
		::-webkit-scrollbar-thumb:hover {
		  width: 10px;
		}
		@media screen and (max-width:530px){
			.boxheigth{
				height: calc(100vh - 196px)
			}
		}
	</style>
</head>
<body>


<div class="display-4 text-center">Welcome To Live Chat</div>
<div class="d-flex boxheigth">
	<div class="container w-75 bg-light rounded overflow-auto" id="chat-board">
		<ul class="ul p-0 m-0">
		</ul>
		
	</div>
</div>


<div class="form-group col-md-12 justify-content-center position-fixed textbox">
	<form class="col-md-8 mr-auto ml-auto d-flex" action="">
	<!-- 	<button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-expanded="false">
			hoi
      <span class="sr-only">Toggle Dropdown</span>
    </button>
 --><div class="input-group">
  <div class="col-md-10 input-group-prepend pr-0">
<div class="btn-group dropup">
  <button type="button" class="btn btn-secondary dropdown-toggle" id="sendto" data-toggle="dropdown" aria-expanded="false">Everyone</button>
  <div class="dropdown-menu">
    <button class="dropdown-item" type="button" onclick="sendTo(this)">Everyone</button>
    <button class="dropdown-item" type="button" onclick="sendTo(this)">Khizar</button>
    <button class="dropdown-item" type="button" onclick="sendTo(this)">Test1</button>
    <button class="dropdown-item" type="button" onclick="sendTo(this)">Test2</button>
  </div>
</div>
		<input type="text" class="form-control rounded-0" name="message-input" autocomplete="off">
  </div>
 	<input type="submit" class="btn btn-outline-primary pl-2 col-md-2" name="">
	</form>
</div>
<script src="/socket.io/socket.io.js"></script>
<script >
 const form = document.querySelector("form");
 const input = document.querySelector("input");
  messageList = document.querySelector("ul");
 const socket = io();
 // socket.emit('message', ['new','joining',name]);
</script>
	<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
	const firebaseConfig = {
	    apiKey: "AIzaSyArozbdTXvE48PJJ6vmfvlJhYw8piGasUU",
	    authDomain: "chat-io-3de79.firebaseapp.com",
	    databaseURL: "https://chat-io-3de79-default-rtdb.asia-southeast1.firebasedatabase.app",
	    projectId: "chat-io-3de79",
	    storageBucket: "chat-io-3de79.appspot.com",
	    messagingSenderId: "404478950204",
	    appId: "1:404478950204:web:c1f29fa040abc669d7fc39"
	  };

	  // Initialize Firebase
	  const app = initializeApp(firebaseConfig);
	  import {getDatabase, ref, set, child, update, remove}
	  from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"
	  const db = getDatabase();
	  var user="User"+name
	  function InsertData(){
	  	set(ref(db,"UserJoin--"+name+Date().substr(0,25)),{
	  		UserName:name
	  	})
	  	.then(()=>{console.log("name register");})
	  	.catch((error)=>{console.log(error)})
	  }
	// InsertData()
	 const form = document.querySelector("form");
 const input = document.querySelector("input");
  messageList = document.querySelector("ul");
 const socket = io();
  socket.emit('joining msg', [false,name]);
   form.addEventListener("submit", function(e){
 	e.preventDefault();
 	if(input.value == ''){return}
 	FinalMessage = [true,name,input.value,sendto_Value()];
 	socket.emit("message", FinalMessage);
 	input.value = '';
 });
	var FinalMessage,content;
	function sendTo(val){
	 	document.getElementById('sendto').innerText = val.innerText;
	}
	function sendto_Value(){return document.getElementById('sendto').innerText}
	function myFunction(e) {
		e.preventDefault();
	  console.log('hi')
	}
	function addMessageToHTML(message) {
	  	const li = document.createElement("li");
	  	var board = document.getElementById('chat-board')
	  	if(message[0]===true){
			if(message[1] == name){
				li.classList.add('p-2','ml-auto');
				content ='<div class="bgcolor px-2 bl">'+message[2]+'</div>'
			}else{
			  	if(message[3]!="Everyone"){
			  		if (message[3] != name){
				  		return
			  		}
			  	}
				li.classList.add('bgcolor','px-2','br')
				content = message[1]+' : '+message[2]
			}
		  	li.innerHTML = content;
	  	}
	  	if(message[0]===false){

	  		li.classList.add('ml-auto','mr-auto','py-2')
	  		li.style.textAlign = "center"
	  		li.innerHTML ='<div class="px-2 jointtxt rounded">'+message[1]+'</div>'
	  	}
	  	messageList.append(li)
	  	board.scrollTop = board.scrollHeight
	  }

	 socket.on("message", addMessageToHTML);

	  window.addEventListener('beforeunload', function (e) {
	InsertData()
    e.preventDefault();
    e.returnValue = '';
	 		console.log("data up")
	 	console.log("done print dis")
    console.log("tjis is ")
});
	</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script type="text/javascript">
            $(function () {
  $('[data-toggle="popover"]').popover()
})
            $(function () {
  $('[data-toggle="tooltip"]').tooltip()
})        </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
</body>
</html>
